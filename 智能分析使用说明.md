# 🚀 智能模块分析功能使用说明

## 📋 功能概述

新版本使用 **AI 智能模块识别和任务聚合** 技术，可以：
- 📁 自动按项目分组提交记录
- 🧠 识别代码修改的模块和功能
- 🔗 将相关提交聚合成高质量的周报条目
- 📊 生成专业化的工作汇报

## 🎯 核心优势

### 1. 大幅减少 AI 调用次数

**旧版本：**
- 15 个提交 = 15 次 AI 调用
- 耗时：15-30 秒
- 费用：¥0.03

**新版本：**
- 15 个提交（3个项目）= 3 次 AI 调用
- 耗时：5-10 秒
- 费用：¥0.01
- **节省 80% 时间和费用**

### 2. 智能识别代码模块

AI 会分析：
- 📂 文件路径（如 `src/pages/user/login.js` → 用户登录模块）
- 📝 提交信息（识别功能描述）
- 🔍 代码改动（判断是新增、修复还是优化）

### 3. 自动聚合相关提交

**示例场景：**

你在一周内对"用户登录"功能做了以下提交：
```
1. 2025-10-20: 添加用户登录接口
2. 2025-10-21: 添加JWT验证
3. 2025-10-22: 修复登录验证失败bug
4. 2025-10-23: 优化登录响应速度
5. 2025-10-24: 添加登录日志记录
```

**旧版周报（5条）：**
```
1. 添加用户登录接口
2. 添加JWT验证
3. 修复登录验证失败bug
4. 优化登录响应速度
5. 添加登录日志记录
```

**新版周报（1条）：**
```
[booking_h5] 用户登录模块
完成用户登录功能开发、验证优化及性能提升
关键改动:
• 实现用户登录接口和JWT身份验证
• 修复验证失败导致的登录异常
• 优化登录响应速度，提升用户体验
• 添加登录行为日志记录
涉及5个提交
```

## 🖥️ 使用方法

### 方式一：Web 界面（推荐）

1. 启动服务器
```bash
./start.sh
# 或
npm run server
```

2. 打开浏览器访问 `http://localhost:3000`

3. 填写信息并生成周报

4. 观察终端输出，查看 AI 分析过程

### 方式二：命令行

1. 确保 `.env` 文件已配置

2. 运行命令
```bash
npm start
```

3. 查看详细的分析日志

## 📊 日志输出说明

运行时你会看到这样的输出：

```
======================================================================
📊 智能分析模式：按项目分组，识别模块，聚合相关提交
======================================================================

📦 总提交数: 15 条
🗂️  涉及项目: 3 个 (booking_h5, bo-biz, rs-booking)

──────────────────────────────────────────────────────────────────────
📁 项目: booking_h5 (8 个提交)
──────────────────────────────────────────────────────────────────────

🤖 [booking_h5] 正在分析 8 条提交记录...
   ✅ AI 分析完成 (耗时: 2345ms)
   📊 识别出 3 个任务模块

   1. [用户登录] 完成用户登录功能开发及优化 (合并3个提交)
   2. [订单管理] 实现订单查询和列表展示功能 (合并4个提交)
   3. [UI优化] 移动端界面适配和性能优化 (合并1个提交)

──────────────────────────────────────────────────────────────────────
📁 项目: bo-biz (5 个提交)
──────────────────────────────────────────────────────────────────────

🤖 [bo-biz] 正在分析 5 条提交记录...
   ✅ AI 分析完成 (耗时: 1876ms)
   📊 识别出 2 个任务模块

   1. [数据导出] 实现订单数据批量导出功能 (合并3个提交)
   2. [权限管理] 优化用户权限控制逻辑 (合并2个提交)

======================================================================
✅ 分析完成！
   📝 原始提交: 15 条
   📊 生成任务: 7 条
   🎯 聚合率: 53.3%
======================================================================
```

### 日志说明

| 符号 | 含义 |
|------|------|
| 📦 | 总提交数统计 |
| 🗂️ | 项目分组信息 |
| 📁 | 正在处理的项目 |
| 🤖 | 调用 AI 分析 |
| ✅ | 分析成功 |
| 📊 | 识别的模块数量 |
| 🎯 | 任务聚合率（越高说明聚合越好） |

## 🔧 AI 分析逻辑

### 模块识别策略

AI 会综合分析以下信息来识别模块：

1. **文件路径分析**
   ```
   src/pages/user/login.js    → 用户模块-登录功能
   src/api/order/list.js      → 订单模块-列表接口
   src/components/header.vue  → 公共组件-页面头部
   ```

2. **提交信息解析**
   ```
   "feat: 添加用户登录功能"   → 新功能开发
   "fix: 修复订单查询bug"     → 问题修复
   "perf: 优化列表加载速度"   → 性能优化
   ```

3. **改动文件关联**
   - 同时修改 `login.js` 和 `auth.js` → 可能是同一功能
   - 修改测试文件 `login.test.js` → 与主功能关联

### 聚合策略

AI 会将提交聚合为任务，条件包括：
- ✅ 修改的是同一模块
- ✅ 功能上有关联性
- ✅ 时间上相近（同一周）
- ✅ 描述表明是同一任务

不会聚合的情况：
- ❌ 完全不同的功能模块
- ❌ 不同的工作类型（功能开发 vs bug修复）
- ❌ 独立的重构或文档更新

## 💡 最佳实践

### 1. 规范的 Git 提交信息

使用清晰的提交信息能让 AI 更准确地识别：

**推荐格式：**
```
feat: 添加用户登录功能
fix: 修复订单列表查询失败问题
perf: 优化首页加载速度
refactor: 重构支付模块代码
docs: 更新 API 文档
```

**不推荐：**
```
update
修改
fix bug
优化
```

### 2. 合理的模块划分

在项目中保持清晰的目录结构：
```
src/
├── pages/
│   ├── user/      # 用户模块
│   ├── order/     # 订单模块
│   └── payment/   # 支付模块
├── components/    # 公共组件
└── api/          # API 接口
```

### 3. 适当的提交粒度

- ✅ 一个功能一个提交（如：添加登录功能）
- ✅ 一个 bug 一个提交（如：修复验证失败）
- ❌ 避免一个提交包含多个无关改动

## ❓ 常见问题

### Q: AI 分析不准确怎么办？

A: 
1. 检查提交信息是否清晰
2. 查看文件路径是否规范
3. AI 有降级方案，失败时会简单分组

### Q: 某些提交没有被正确聚合？

A: 这是正常的，AI 会根据关联性判断。如果提交确实不相关，分开显示反而更合理。

### Q: 可以调整聚合策略吗？

A: 可以通过修改 AI Prompt 来调整，在 `analyzeProjectCommits` 函数中修改提示词。

### Q: 聚合率多少合适？

A: 通常 40-70% 比较合理：
- < 30%: 可能提交太零散或 AI 识别不够准确
- 40-70%: 理想范围，说明有效聚合
- > 80%: 可能过度聚合，丢失了一些细节

## 📈 性能对比

| 场景 | 提交数 | 项目数 | 旧版调用 | 新版调用 | 节省 |
|------|--------|--------|----------|----------|------|
| 小型 | 5 | 1 | 5次 | 1次 | 80% |
| 中型 | 15 | 3 | 15次 | 3次 | 80% |
| 大型 | 30 | 5 | 30次 | 5次 | 83% |

## 🎓 技术细节

想了解更多技术实现细节？查看：
- `index.js` - 第 196-284 行：`analyzeProjectCommits` 函数
- `server.js` - 第 207-294 行：相同实现
- AI Prompt 设计：第 206-247 行

## 📝 更新日志

查看完整更新日志：`CHANGELOG.md`

