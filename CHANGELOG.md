# 更新日志

## [重大升级] 2025-10-23 - 智能模块分析

### 🚀 核心功能升级：智能模块识别和任务聚合

**重要变更：**
这是一次**架构级别**的升级，从"逐个提交分析"转变为"按项目分组 + 智能模块聚合"。

**新功能特性：**

1. **📁 按项目分组处理**
   - 自动将提交按项目分组
   - 每个项目独立分析，结果更清晰

2. **🧠 智能模块识别**
   - AI 根据文件路径识别代码模块（如：用户模块、订单模块）
   - 自动分析模块涉及的功能和业务价值
   
3. **🔗 智能任务聚合**
   - 将同一功能的多次提交合并为一个任务
   - 例如：登录模块的 5 个提交 → 1 条周报任务
   
4. **📊 更专业的周报格式**
   - 任务描述更符合汇报习惯
   - 自动生成关键改动列表
   - 显示涉及的提交数量

**效果对比：**

旧方式（15个commit = 15条任务）：
```
1. 添加用户登录接口
2. 修复登录验证bug
3. 优化登录性能
4. 添加订单列表页面
5. 修复订单查询bug
...（共15条）
```

新方式（15个commit = 3-5条任务）：
```
1. [booking_h5] 用户登录模块
   完成用户登录功能开发及优化
   关键改动:
   • 实现JWT身份验证
   • 修复验证失败问题
   • 优化登录响应速度
   涉及3个提交

2. [booking_h5] 订单管理模块
   实现订单查询和列表展示功能
   关键改动:
   • 开发订单列表页面
   • 实现高级筛选功能
   • 修复查询性能问题
   涉及5个提交
```

**技术改进：**
- ✅ AI 调用次数大幅减少（3个项目 = 3次调用，而非15次）
- ✅ 处理速度更快（并发处理项目）
- ✅ 周报质量更高（专业化描述）
- ✅ 成本更低（减少70-90%的API调用）

**日志输出示例：**
```
======================================================================
📊 智能分析模式：按项目分组，识别模块，聚合相关提交
======================================================================

📦 总提交数: 15 条
🗂️  涉及项目: 3 个 (booking_h5, bo-biz, rs-booking)

──────────────────────────────────────────────────────────────────────
📁 项目: booking_h5 (8 个提交)
──────────────────────────────────────────────────────────────────────

🤖 [booking_h5] 正在分析 8 条提交记录...
   ✅ AI 分析完成 (耗时: 2345ms)
   📊 识别出 3 个任务模块

   1. [用户登录] 完成用户登录功能开发及优化 (合并3个提交)
   2. [订单管理] 实现订单查询和列表展示功能 (合并4个提交)
   3. [UI优化] 移动端界面适配和性能优化 (合并1个提交)

======================================================================
✅ 分析完成！
   📝 原始提交: 15 条
   📊 生成任务: 7 条
   🎯 聚合率: 53.3%
======================================================================
```

---

### 🔍 移除缓存机制，优化 AI 调用日志

**改进内容：**
- ✅ 移除了提交信息的内存缓存机制
- ✅ 每次都实时调用 DeepSeek AI 进行解析
- ✅ 添加详细的 AI 调用日志，包括：
  - 🤖 调用时显示正在解析的提交信息
  - ⏱️ 显示 API 调用耗时
  - ✅ 显示解析结果
  - ❌ API 调用失败时显示错误信息
  - ⚠️ 使用降级方案时的提示

**日志示例：**
```
📊 开始使用 DeepSeek AI 解析 3 条提交记录...

[1/3] 处理提交: 2a3b4c5d (2025-10-23)
🤖 调用 DeepSeek AI 解析: [project-name] fix: 修复登录页面验证错误...
   ✅ AI 解析完成 (耗时: 1234ms) -> 修复登录页面验证逻辑错误

[2/3] 处理提交: 6e7f8g9h (2025-10-23)
🤖 调用 DeepSeek AI 解析: [project-name] feat: 添加用户权限管理功能...
   ✅ AI 解析完成 (耗时: 1567ms) -> 实现用户权限管理模块

✅ DeepSeek AI 解析完成！共处理 3 条提交，生成 3 条任务
```

**优势：**
- 🔍 **透明度**：清楚知道何时调用了 AI
- ⏱️ **性能监控**：可以看到每次 API 调用的耗时
- 🐛 **调试友好**：便于排查问题
- 📊 **实时性**：不使用缓存，确保每次都获取最新结果

---

### ✨ DeepSeek API Key 配置方式优化

**改进内容：**
- ✅ 新增 `dotenv` 包支持，实现自动加载 `.env` 文件
- ✅ 创建 `.env.example` 模板文件，方便用户配置
- ✅ 更新 `.gitignore`，确保 `.env` 不会被提交到版本控制
- ✅ 优化 `start.sh` 启动脚本，提供更友好的提示
- ✅ 更新 `README.md` 文档，说明最佳配置方式

**使用方式：**

推荐使用 `.env` 文件（标准做法）：
```bash
cp .env.example .env
# 编辑 .env 文件，填入你的 API Key
```

备选方式（兼容旧方式）：
```bash
export DEEPSEEK_API_KEY="sk-your-api-key-here"
```

**优势：**
- 🔒 **安全性**：`.env` 文件不会被提交到版本控制
- 👥 **团队协作**：每个开发者可以有独立的配置
- 🚀 **便利性**：无需每次重启终端都重新设置环境变量
- 📦 **标准化**：符合 Node.js 社区最佳实践

**技术细节：**
- `index.js` 和 `server.js` 在启动时自动调用 `require('dotenv').config()`
- 支持两种配置方式：`.env` 文件优先，环境变量作为备选
- 启动脚本会检测 `.env` 文件是否存在并给出友好提示
